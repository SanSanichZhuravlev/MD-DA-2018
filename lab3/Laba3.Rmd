---
title: "Laba3"
author: "Alexander Zhuravlev"
date: '4 октября 2018 г '
output: html_document
---

#Задачи для лаборатоной работы:
######
1. Работа с текстом;
2. Использование регулярных выражений для извлечения данных;
3. Переписывание существующего кода;
4. Асимметричные распределения.
######

# Исходные данные
# Файл forbes.htm содержит список богатейших американцев по версии журнала Форбc.


# Задание № 1
# Используйте команду readlines для загрузки файла
```{r}
rating <- readLines("https://github.com/SergeyMirvoda/MD-DA-2018/tree/master/data/forbes.htm")
```
#Сколько строк в файле?
```{r}
length(rating)
```
#Сколько символов в файле?
```{r}
sum(nchar(rating))
```
#Напишите шаблон регулярного выражения и используйте функцию grep, чтобы извлечь размер дохода из данных в векторе html.
#Удостоверьтесь, что полученный вектор номеров строк содержит содержит ровно 100 записей
#и ссылается на номера строк в котрых действительно есть информация о доходе, а не просто первый попавшийся текст.
```{r}
rating.check <- grep("[$][,0-9]+ [BM]", rating)
length(rating.check) == 100
```
#Напишите код, использовав регулярное выражение из п. 3, и функции regexp и regmatches, чтобы извлечь все данные о доходе.
```{r}
rating.checks <- regmatches(rating, regexpr("[$][,0-9]+ [BM]", rating))
```
#Проверьте следующее:
#Должно быть ровно сто значений.
```{r}
stopifnot(length(rating.checks) == 100)
```
#Самый большой доход должен быть доход Билла Гейтса
#Такой доход должен быть в списке один раз.
#В всписке должна быть цифра, которую мы запомнили для Ларри Эллисона.
#Должно быть как минимум два значения, встречающихся несколько раз.
```{r}
rating.checks.stats <- table(rating.checks)
as.data.frame(rating.checks.stats)
```

#Задание 2
#В данных доход представлен в формате "$42 B", что означает 42 × 10^9. 
#Преобразуйте этот формат в числовой и сохраните в вектор worths. 
```{r}
B <- 10**9
rating.checks.modify <- gsub(",", "\\.", rating.checks)
worths <- as.double(regmatches(rating.checks.modify, regexpr("[0-9.]+", rating.checks.modify))) * B
```
#Удостоверьтесь в следующем:
#worths является вектором и в нём сто занчений типа double.
```{r}
length(worths)
typeof(worths)
```
#Все элементы вектора worths больше 1 миллиарда.
```{r}
all(worths > B)
```
#Самое большое число это доход Билла Гейтса.
```{r}
as.data.frame(head(worths))
```
#Используйте вектор worths , чтобы выяснить следующее:
# Какова медиана ста этих записей?
```{r}
median(worths)
```
#Средний доход
mean(worths)
#Как много людей из этого списка имеют доход больше 5млрд., 10, 25?
```{r}
length(worths[which(worths > 5*B)])
length(worths[which(worths > 10*B)])
length(worths[which(worths > 25*B)])
```
#Какой их общий доход?
```{r}
sum(worths)
```
#Какую долю от общего дохода, составляет пятёрка самых богатых.
```{r}
sum(worths[1:5]) * 100 / sum(worths)
```
#Какую долю от общего дохода, составляют 20 самых богатых.
```{r}
print(sum(worths[1:20]) * 100 / sum(worths))
```
#В данных федерального резерва США найдите показатель дохода всех домохозяйств (Household net worth) в соответвующем году
#какую долю общего дохода составляют 100 богатейших людей.
```{r}
Household_net_worth <- 125.981 * B
print(Household_net_worth * 100 / sum(worths))
```

#Вывод: в ходе данной лабораторной работы проведена работа с:
######
1. текстом;
2. регулярными выражениями для извлечения данных;
3. переписыванием существующего кода;
4. асимметричными распределениями.