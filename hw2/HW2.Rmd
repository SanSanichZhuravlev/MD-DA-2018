---
title: "HW2"
author: "Alexander Zhuravlev"
date: '9 октября 2018 г '
output: html_document
---
#Исходные данные
#По адресу https://raw.githubusercontent.com/SergeyMirvoda/da2016/master/data/calif_penn_2011.csv можно получить набор данных, содержащий информацию о домовладениях в Калифорнии и Пенсильвании за 2011г. Информация сгруппированна по зонам переписи.
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
##Загузка и очистка данных
#Загрузите данные в датафрейм, который назовите data.
```{r}
pens <- read.csv2("https://raw.githubusercontent.com/SergeyMirvoda/da2016/master/data/calif_penn_2011.csv", header = TRUE, sep = ",")
data <- data.frame(pens)
```
#Сколько строк и столбцов в data?
```{r}
nrow(data)
ncol(data)
```
#Выполните следующую команду и объясните, что она делает. colSums(apply(data,c(1,2), is.na))
#Сколько строк и столбцов в data?
```{r}
colSums(apply(data, c(1,2), is.na))
```
#Функция  colSums вычисляет сумму по колонкам
#Функция apply имеет параметры: data(массив), c(1,2)- проход по всем колонкам и строкам, is.na - специальный флаг

#Функция na.omit() принимает датафрейм и возвращает новый датафрейм, игнорируя строки, содержащие значение NA. Используйте эту функцию для удаления строк с неполными данными.
```{r}
nrows <- nrow(data)
newData <- na.omit(data)
```
#Сколько строк было удалено?
```{r}
nrows - nrow(newData)
```
#Соответствует ли результат выполнения, значениям из пункта 3?
#Результат отличается,поскольку в одной строке могут быть несколько пустых клеток


##Новые дома
#Переменная(колонка) Built_2005_or_later содержит данные о проценте домов, построенных с 2005 года. Постройте диаграмму рассеяния (scatterplot) медианы стоимости домов (переменная Median_house_value) относительно процента новых домов.
```{r}
scatter.smooth(data$Built_2005_or_later, data$Median_house_value)
```
#Постройте ещё два графика для каждого из штатов отдельно. Номер штата содержится в переменной (STATEFP), где Калифорния 6-й штат, а Пенсильвания 42.
```{r}
scatter.smooth(data$Built_2005_or_later[data$STATEFP==6], data$Median_house_value[data$STATEFP==6])
```
```{r}
scatter.smooth(data$Built_2005_or_later[data$STATEFP==42], data$Median_house_value[data$STATEFP==42])
```


##Незанятые дома
#В датафрейм data добавьте новую колонку vacancy_rate, которая должна содержать вышеописанный показатель.
```{r}
data$vacancy_rate <- data$Vacant_units / data$Total_units
```
#Найдите минимум, максимум, среднее и медиану полученных значений показателя.
```{r}
min(data$vacancy_rate)
max(data$vacancy_rate)
mean(data$vacancy_rate)
median(data$vacancy_rate)
```
#Постройте диаграмму уровня найма относительно медианы стоимости домов. Что можно заметить?
```{r}
plot(data$Median_house_value, data$vacancy_rate)
```
#По диаграме можно заметить, что чем больше средняя стоимость жилья, тем меньше уровень найма.

##Корреляция
#Колонка COUNTYFP содержит числовой код округа внутри штата. Нас интересуют Butte County (округ 7 в Калифорнии), Santa Clara (округ 85 в Калифорнии) и York County (округ 133 в Пенсильвании).
#Объясните, что делает приведённый в конце задания код и как именно он это делает.
```{r}
acc <- c()
for (tract in 1:nrow(data)) {
#добавляем штат под цифрой 6 (Калифорния), в ней город 1 (Аламеда)
  if (data$STATEFP[tract] == 6) {
    if (data$COUNTYFP[tract] == 1) {
      acc <- c(acc, tract)
    }
  }
}
accmv <- c()
for (tract in acc) {
#заполняем вектор accmv значениями Median_house_value
  accmv <- c(accmv, data[tract,10])
}
#находим медиану полученного массива
median(accmv)
```
#Напишите другим способом в одну строку, то же самое, что делает нижеуказанный код. Способов получить тот же ответ множество, достаточно одного.
```{r}
median(data$Median_house_value[data$STATEFP==6][data$COUNTYFP==1],na.rm=TRUE)
```
#Найдите средний процент построенных домовладений в округах (Butte County, Santa Clara, York County)
```{r}
CA_Index <- data$STATEFP == 6 #Код Калифорнии
CA_Household_Units <-  sum(data$Total_units[CA_Index])
PA_Index <- data$STATEFP == 42#Код Пенсильвании
PA_Household_Units <- sum(data$Total_units[PA_Index])
```
```{r}
##Butte County, CA
CA_BC_Index <- data$COUNTYFP == 7
mean(data$Total_units[CA_Index & CA_BC_Index] / CA_Household_Units, na.rm = TRUE)
##Santa Clara, CA
CA_SC_Index <- data$COUNTYFP == 85
mean(data$Total_units[CA_Index & CA_SC_Index] / CA_Household_Units, na.rm = TRUE)
##York County, PA
PA_YC_Index <- data$COUNTYFP == 133 
mean(data$Total_units[PA_Index & PA_YC_Index] / PA_Household_Units, na.rm = TRUE)
```
#Функция cor рассчитывает коэффициент корреляции между двумя переменными. Рассчитайте корреляцию между медианы стоимости домовладений (Median_house_value) и процентом построенных домов (Built_2005_or_later):
#для всего набора данных
```{r}
cor(as.numeric(data$Built_2005_or_later), data$Median_house_value)
```
#для Калифорнии
```{r}
cor(as.numeric(data$Built_2005_or_later[CA_Index]), data$Median_house_value[CA_Index])
```
#для Пенсильвании
```{r}
cor(as.numeric(data$Built_2005_or_later[PA_Index]), data$Median_house_value[PA_Index])
```
#для округа Butte County
```{r}
cor(as.numeric(data$Built_2005_or_later[CA_Index & CA_BC_Index]), data$Median_house_value[CA_Index & CA_BC_Index])
```
#для округа Santa Clara
```{r}
cor(as.numeric(data$Built_2005_or_later[CA_Index & CA_SC_Index]), data$Median_house_value[CA_Index & CA_SC_Index])
```
#для округа York County
```{r}
cor(as.numeric(data$Built_2005_or_later[PA_Index & PA_YC_Index]), data$Median_house_value[PA_Index & PA_YC_Index])
```
#Постройте три диаграммы медианы стоимости домовладений (Median_house_value) относительно медианы дохода (Median_household_income) для трёх округов. Допустимо указать все три на одном графике.
```{r}
plot( data$Median_house_value[CA_Index & CA_BC_Index], data$Median_household_income[CA_Index & CA_BC_Index])
plot( data$Median_house_value[CA_Index & CA_SC_Index], data$Median_household_income[CA_Index & CA_SC_Index])
plot( data$Median_house_value[PA_Index & PA_YC_Index], data$Median_household_income[PA_Index & PA_YC_Index])
```