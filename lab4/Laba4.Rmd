---
title: "Laba4"
author: "Alexander Zhuravlev"
date: '7 ноября 2018 г '
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#Пользуясь примером из лекции файл (5.0.R) проанализируйте данные
#о возрасте и физ. характеристиках молюсков
#https://archive.ics.uci.edu/ml/datasets/abalone
```{r}
data <- read.csv("https://archive.ics.uci.edu/ml/machine-learning-databases/abalone/abalone.data", header=TRUE, sep=",")
summary(data)
colnames(data)
colnames(data) <- c("sex", "length", "diameter", "height", 
                "whole_weight", "shucked_weight",
                "viscera_weight", "shell_weight", "rings")

colnames(data)
data$sex <- factor(c("Female", "Infant", "Male")[data$sex])
par(mfrow=c(1,3)) 
hist(data$diameter, main = "Диаметр, мм")
hist(data$height, main = "Высота, мм")
hist(data$whole_weight, main = "Полный вес, гр")
```
#Видим ассиметрию https://en.wikipedia.org/wiki/Skewness
#и выбросы (от них нужно избавиться)

#Визулизируем возможные зависимости
```{r}
par(mfrow=c(1,2)) 
plot(data$diameter, data$whole_weight,'p',main = "Зависимость веса от диаметра")
plot(data$height, data$whole_weight,'p',main = "Зависимость веса от высоты")
```
#Хорошо видна зависимость, нужно её исследовать

#построить линейные модели при помощи функции lm, посмотреть их характеристики
```{r}
linear.model.w_d <- lm(data$diameter ~ data$whole_weight, data = data)
summary(linear.model.w_d)
plot(linear.model.w_d, main = "Зависимость веса от диаметра")
linear.model.w_h <- lm(data$height ~ data$whole_weight, data = data)
summary(linear.model.w_h)
plot(linear.model.w_h, main = "Зависмость веса от высоты")
```

#избавиться от выборосов, построить ещё модели и проверить их
```{r}
data.noout <- data[data$height < 0.4 & data$diameter > 0.2 & data$diameter < 0.6 & data$whole_weight < 1.7 & data$whole_weight > 0.1,]
hist(data.noout$diameter, main = "Диаметр мм")
hist(data.noout$height, main = "Высота, мм")
hist(data.noout$whole_weight, main = "Вес, гр")

linear.model.w_d <- lm(data.noout$diameter ~ data.noout$whole_weight, data = data.noout)
summary(linear.model.w_d)
plot(linear.model.w_d, main = "Зависимость веса от диаметра")
linear.model.w_h <- lm(data.noout$height ~ data.noout$whole_weight, data = data.noout)
summary(linear.model.w_h)
plot(linear.model.w_h, main = "Зависмость веса от высоты")
```

#разделить массив данных на 2 случайные части
```{r}
datalength <- nrow(data.noout)
testindex <- seq(1, trunc(datalength * 0.7), by = 1)
controlindex <- seq(round(datalength * 0.3)+1, datalength, by = 1)
sample.test <- data.noout[testindex,]
sample.control <- data.noout[controlindex,]
```

#подогнать модель по первой части
```{r}
linear.model.w_d <- lm(sample.test$diameter ~ sample.test$whole_weight, data = sample.test)
plot(linear.model.w_d, main = "Зависимость веса от диаметра")
linear.model.w_h <- lm(sample.test$height ~ sample.test$whole_weight, data = sample.test)
plot(linear.model.w_h, main = "Зависмость веса от высоты")
```

#спрогнозировать (функция predict) значения во второй части
```{r}
predicted.w_d <- predict(linear.model.w_d, sample.control)
predicted.w_h <- predict(linear.model.w_h, sample.control)
```

#проверить качесвто прогноза
```{r}
cor(sample.control$whole_weight, predicted.w_d)
cor(sample.control$whole_weight, predicted.w_h)
```